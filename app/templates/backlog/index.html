{% extends "base.html" %}
{% block title %}Backlog — Game Journal{% endblock %}

{% block content %}
<div class="flex items-center justify-between mb-8">
  <h1 class="text-2xl font-bold">Backlog</h1>
  <div class="flex gap-2">
    <a href="{{ url_for('backlog.categories') }}"
       class="px-4 py-2 bg-gray-800 hover:bg-gray-700 rounded text-sm transition-colors">
      Categories
    </a>
    <a href="{{ url_for('backlog.add') }}"
       class="px-4 py-2 bg-indigo-700 hover:bg-indigo-600 rounded text-sm transition-colors">
      + Add game
    </a>
  </div>
</div>

{% macro game_row(game) %}
<li class="flex items-center gap-3 bg-gray-900 rounded-lg px-3 py-2 group">
  <!-- Cover -->
  {% if game.cover_url %}
    <img src="{{ game.cover_url }}" alt="{{ game.name }}"
         class="w-8 h-11 object-cover rounded shrink-0">
  {% else %}
    <div class="w-8 h-11 bg-gray-800 rounded shrink-0"></div>
  {% endif %}

  <!-- Info -->
  <div class="flex-1 min-w-0">
    <p class="font-medium text-sm truncate">{{ game.name }}</p>
    {% if game.release_year %}
      <p class="text-xs text-gray-500 truncate">{{ game.release_year }}</p>
    {% endif %}
  </div>

  <!-- Actions -->
  <div class="flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity shrink-0">
    <form method="post" action="{{ url_for('backlog.promote', game_id=game.id) }}">
      <button type="submit"
              class="text-xs px-2.5 py-1 rounded bg-green-800 hover:bg-green-700 text-green-200 transition-colors">
        Play
      </button>
    </form>
    <form method="post" action="{{ url_for('backlog.delete', game_id=game.id) }}"
          onsubmit="return confirm('Remove {{ game.name }} from backlog?')">
      <button type="submit"
              class="text-xs px-2.5 py-1 rounded bg-gray-700 hover:bg-red-900 text-gray-400 hover:text-red-300 transition-colors">
        ✕
      </button>
    </form>
  </div>
</li>
{% endmacro %}

{% if not has_games %}
  <p class="text-gray-500">
    Backlog is empty.
    <a href="{{ url_for('backlog.add') }}" class="text-indigo-400 hover:underline">Add a game.</a>
  </p>
{% endif %}

{% for cat in categories %}
  {% set backlog_games = cat.games | selectattr('section', 'equalto', 'backlog') | list %}
  {% if backlog_games %}
  <section class="mb-8">
    <h2 class="text-sm font-semibold text-gray-400 uppercase tracking-wider mb-2">{{ cat.name }}</h2>
    <ul class="flex flex-col gap-2">
      {% for game in backlog_games %}
        {{ game_row(game) }}
      {% endfor %}
    </ul>
  </section>
  {% endif %}
{% endfor %}

{% if uncategorized %}
<section class="mb-8">
  <h2 class="text-sm font-semibold text-gray-400 uppercase tracking-wider mb-2">Uncategorized</h2>
  <ul class="flex flex-col gap-2">
    {% for game in uncategorized %}
      {{ game_row(game) }}
    {% endfor %}
  </ul>
</section>
{% endif %}
{% endblock %}
